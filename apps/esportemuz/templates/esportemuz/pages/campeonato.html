{% extends "esportemuz/base.html" %}

{% block content %}
<!-- Botão para abrir modal de cadastro de campeonatos -->
<div class="my-3 w-100 d-flex justify-content-end">
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#campeonatoModal">
        <i class="fa fa-plus me-1"></i>
        Criar campeonato
    </button>
</div>

<!-- Modal de cadastro de campeonatos -->
{% include "esportemuz/partials/_modal.html" with modal_id="campeonatoModal" modal_aria_labelledby="campeonatoModal" modal_title="Cadastrar Campeonato" modal_body=form form_action="" form_id="campeonatoForm" %}

<div class="card">
    <div class="card-header">Campeonatos</div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-bordered text-center align-middle mb-0" id="Campeonatos">
                <caption class="pb-0">Lista de campeonatos</caption>
                <thead>
                    <tr>
                        <th scope="col">Nome</th>
                        <th scope="col">Modalidade</th>
                        <th scope="col">Tipo</th>
                        <th scope="col">Data de Início</th>
                        <th scope="col">Data de Fim</th>
                        <th scope="col">Status</th>
                    </tr>
                </thead>
                <tbody id="campeonatos-table-body">

                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock content %}

{% block js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const endpoint = getChampionshipEndpoint();

        renderTable({
            endpoint: endpoint,
            tableBodyId: 'campeonatos-table-body',
            renderRow: renderCampeonatoRow
        });

        setupModalForm({
            formId: 'campeonatoForm',
            modalId: 'campeonatoModal',
            endpoint: endpoint,
            onSuccess: function () {
                renderTable({
                    endpoint: endpoint,
                    tableBodyId: 'campeonatos-table-body',
                    renderRow: renderCampeonatoRow
                });
            }
        });
    });

    // Função para retornar o endpoint da API
    function getChampionshipEndpoint() {
        return `${getApiBaseUrl()}campeonatos/`;
    }

    // Função para renderizar uma linha da tabela de campeonatos
    function renderCampeonatoRow(campeonato) {
        const row = document.createElement("tr");

        row.innerHTML = `
            <td>${campeonato.nome}</td>
            <td>${campeonato.modalidade}</td>
            <td>${campeonato.tipo_campeonato}</td>
            <td>${formatDate(campeonato.data_inicio)}</td>
            <td>${formatDate(campeonato.data_fim)}</td>
            <td>${campeonato.encerrado ? 'Encerrado' : 'Ativo'}</td>
        `;

        return row;
    }
</script>
{% endblock js %}